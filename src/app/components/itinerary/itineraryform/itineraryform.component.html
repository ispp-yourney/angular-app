<app-menu></app-menu>
<h1 class="card-tite">Crear itinerario</h1>
<form [formGroup]="formItiner" (ngSubmit)="onCreate()">
  <section>
    <nav>
      <div class="card" >
        <div class="card-body">
        

              <div class="form-group">
                <label class="col-form-label" for="name">Nombre<span style="color:#ff0000">*</span></label>
                <input type="text" class="form-control" id="name" formControlName="name" required minlength="5" maxlength="50" placeholder="Viaje a Corea">
                <div class="alert alert-danger" *ngIf="formItiner.get('name').touched && formItiner.get('name').invalid">
                  <div *ngIf="formItiner.get('name').errors.required">No puede quedar vacío</div>
                  <div *ngIf="formItiner.get('name').errors.minlength">Debe de tener al menos 5 caracteres</div>
                  <div *ngIf="formItiner.get('name').errors.maxlength">Debe de tener como máximo 50 caracteres</div>
                </div>
              </div>

              <div class="form-group">
                <label for="description">Descripción</label>
                <textarea id="description" class="form-control" rows="3" formControlName="description"></textarea>
              </div>
              <p>Caracteres disponibles: {{1000-formItiner.get('description').value.length}}</p>

              <div class="form-group">
                <label class="col-form-label" for="budget">Presupuesto<span style="color:#ff0000">*</span></label>
                <input type="number" class="form-control" id="budget" formControlName="budget" value="0" required min="0" placeholder="0">
                <div class="alert alert-danger" *ngIf="formItiner.get('budget').touched && formItiner.get('budget').invalid">
                  <div *ngIf="formItiner.get('budget').errors.required">No puede quedar vacío</div>
                  <div *ngIf="formItiner.get('budget').errors.min">El valor mínimo es 0</div>
                </div>
              </div>

              <div class="form-group">
                <label class="col-form-label" for="itineraryImage">Imagen</label>
                <br>
                <input type="file" id="itineraryImage" class="file-input" (change)="addItineraryImage($event.target.files)">
              </div>

              <div class="form-group mb-3">
                <label class="col-form-label" for="season">Estación<span style="color:#ff0000">*</span></label>
                <select class="form-control" id="season" formControlName="recommendedSeason">
                  <option label="INVIERNO">WINTER</option>
                  <option label="PRIMAVERA">SPRING</option>
                  <option label="VERANO">SUMMER</option>
                  <option label="OTOÑO">FALL</option>
                </select>
              </div>
          <div style="text-align:center!important">
            <button type="submit" class="btn btn-primary" style="margin:5px" [disabled]="!formItiner.valid">Crear Itinerario</button>
            <button type="button" class="btn btn-primary" style="margin:5px" (click)="addDay()">Añadir nuevo día</button>
          </div>
        </div>
      </div>
    </nav>

    <article>
      <div *ngIf="formItiner.get('days')['controls'].length > 0" formArrayName="days">

        <div *ngFor="let day of formItiner.get('days')['controls']; let i=index" [formGroupName]="i">

          <br>
          <div class="card mb-3 dropdown" style="border: none; ">

            <div class="card-header d-flex">
            <h2 class="p-2 mt-3">Día {{i+1}}</h2>
              <button type="button" class="btn ml-auto p-2" (click)="addActivity(day.get('activities'))">
                <em class="fa fa-plus-circle fa-3x" aria-hidden="true" style="color:white;"></em>
              </button>
              <button type="button" class="btn ml p-2" (click)="removeDay(i)">
                <em class="fa fa-minus-circle fa-3x" aria-hidden="true" style="color:white"></em>
              </button>
            </div>

            <!-- Delete Day confirmation -->

            <!-- end Delete Day confirmation -->

            <div class="card-body mb-3"  style="border: none; ">

              <div *ngIf="day.get('activities')['controls'].length > 0" formArrayName="activities">
                <div *ngFor="let activity of day.get('activities')['controls']; let j=index" [formGroupName]="j">

                  <div class="card mb-3 dropdown" style="border: none; box-shadow: none; height: 30px;">

           

                      <span  class="btn btn-primary btn-header-card" style="float: left;" data-toggle="modal" [attr.data-target]="'#day' +(i+1)+''+(j+1)" data-backdrop="static" data-keyboard="false">

                        Actividad {{j+1}} {{ activity.get('title').value != null && activity.get('title').value != '' ? ': '+activity.get('title')?.value : ''}} &nbsp;&nbsp;

                      

                        </span>
                      
                  
                    <div style="position: relative; bottom: 30px; left: 60vw; width: 10px;">
                      <em type="button" data-toggle="modal" data-backdrop="static" data-keyboard="false" [attr.data-target]="'#DeleteActivity' +(i+1)+''+(j+1)" class="fa fa-minus-circle" aria-hidden="true" style="color:rgb(255, 255, 255)"></em>
                    </div>
                     <!-- Delete Activity confirmation -->
  
         
                  <div class="modal fade" id="DeleteActivity{{(i+1)+''+(j+1)}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLongTitle">Confirmación</h5>
                        </div>
                        <div class="modal-body">
                          ¿Quieres borrar la actividad?
                        </div>
                        <div class="modal-footer">
                          <a type="button" class="btn btn-secondary"   data-dismiss="modal">Cancelar</a>
                          <a type="button" class="btn btn-primary" (click)="removeActivity(day.get('activities'), j)" data-dismiss="modal">Confirmar</a>
                        </div>
                      </div>
                    </div>
                  </div>


                     <!-- end Delete Day confirmation -->



                    <div class="modal fade" id="day{{(i+1)+''+(j+1)}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" >
                      <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLongTitle">Actividad {{j+1}}</h5>
                         
                          </div>
                          <div class="modal-body">
                            <label for="title">Título <span style="color:#ff0000">*</span></label>
                            <input type="text" id="title" formControlName="title" class="form-control" placeholder="Visita Seoul">
                            <div class="alert alert-danger" *ngIf="activity.get('title').touched && activity.get('title').invalid">
                              <div *ngIf="activity.get('title').errors.required">No puede quedar vacío</div>
                            </div>
                            <br>
                            <br>
                            <label for="description">Descripción <span style="color:#ff0000">*</span></label>
                            <textarea id="description" formControlName="description" class="form-control" placeholder="Nos lo pasamos increíble..." cols="30" rows="10"></textarea>
                            <div class="alert alert-danger" *ngIf="activity.get('description').touched && activity.get('description').invalid">
                              <div *ngIf="activity.get('description').errors.required">No puede quedar vacío</div>
                            </div>
                            <p>Caracteres disponibles: {{1000-activity.get('description').value.length}}</p>

                            <div style="text-align:center!important" *ngIf=" activity.controls['action'].value == 'true'">
                              <label for="description">Punto de interés <span style="color:#ff0000">*</span></label>
                              <a type="button" class="btn btn-primary" style="margin:5px" (click)="clickLandmarkShare(activity)" >Añadir Landmark</a>
                              <a type="button" class="btn btn-primary" style="margin:5px" (click)="addLandmark(activity)">Crear Landmark</a>
                            </div>


                            
                            <div [style.display]="activity.get('searchLandmark').value">
                             <div class="landmarks" >
                             
                                  <app-buscador-landmark (landmarkId)="existLandmark(activity,$event)" [create]="true"></app-buscador-landmark>
                             </div> 
                            </div>

                             <div *ngIf="activity.get('landmark')['controls'].length > 0" formArrayName="landmark">
                            <div *ngFor="let l of activity.get('landmark')['controls']; let u = index" [formGroupName]="u">
                              <h2 style="color:grey">Datos de la ubicación</h2>
                            

                              <label for="name">Nombre del la ubicación <span style="color:#ff0000">*</span></label>
                              <input type="text" id="name" formControlName="name" class="form-control" placeholder="Bar Itaewon" required>
                              <!-- <div class="alert alert-danger" *ngIf="activity.get('landmark')[0].touched && activity.get('landmark')[0].invalid">
                                <div *ngIf="activity.get('landmark')[0].errors.required">No puede quedar vacío</div>
                              </div> -->
                              <br>
  
                              <label for="description2">Descripción de la ubicación <span style="color:#ff0000">*</span></label>
                              
                              <textarea id="description2" formControlName="description2" class="form-control" placeholder="Comida increíble..." cols="30" rows="10" required></textarea>
                              <p>Caracteres disponibles: {{1000-activity.get('landmark')['controls'][0]['controls'].description2.value.length}}</p>
                              <br>
                              <label for="price">Precio <span style="color:#ff0000">*</span></label>
                              <input type="number" id="price" formControlName="price" class="form-control" value="0" required min="0" placeholder="0">
                              
                              <br>
  
                              <label for="country">País<span style="color:#ff0000">*</span></label>
                              <input type="text" id="country" formControlName="country" class="form-control" placeholder="Corea" >
  
                              <br>
                              <label for="city">Ciudad<span style="color:#ff0000">*</span></label>
                              <input type="text" id="city" formControlName="city" class="form-control" placeholder="Seoul">
  
                              <br>
                              <label for="latitude">Latitud</label>
                              <input type="number" id="latitude" formControlName="latitude" class="form-control" placeholder="12">
                            
                              <br>
                              <label for="longitude">Longitud</label>
                              <input type="number" id="longitude" formControlName="longitude" class="form-control" placeholder="24">
                            
  
                              <br>
                              <label for="category">Categoría</label>
                              <input type="text" id="category" formControlName="category" class="form-control" placeholder="Restaurante">
  
                              <br>
                              <label for="email">Email</label>
                              <input type="text" id="email" formControlName="email" email class="form-control" placeholder="example@gmail.com">
                            
                              <br>
  
                              <label for="phone">Teléfono</label>
                              <input type="text" id="phone" formControlName="phone" class="form-control" placeholder="+(82) 847192673 ">
                           
  
  
                              <br>
                              <label for="website">Sitio web</label>
                              <input  id="website" formControlName="website" class="form-control" placeholder="https://www.website.com" >
                             
                              <br>
                              <label for="instagram">Instagram</label>
                              <input type="text" id="instagram" formControlName="instagram" class="form-control" placeholder="https://www.instagram.com">
                             
                            
  
                              <br>
                              <label for="twitter">Twitter</label>
                              <input type="url" id="twitter" formControlName="twitter" class="form-control" placeholder="https://www.twitter.com">
                           


                            <div class="form-group">
                              <label class="col-form-label" for="landmarkImage">Imagen</label>
                              <br>
                              <input type="file" id="landmarkImage" class="file-input"  (change)="addLandmarkImage($event.target.files,activity)">
                            </div>


                            <br>
                            
                            <!-- <div class="alert alert-danger"
                            *ngIf="activity.get('email').touched && activity.get('email').invalid">
                              <div *ngIf="activity.get('email').errors.maxlength">Debe de tener como máximo 50 caracteres</div>
                              <div *ngIf="activity.get('email').errors.email || activity.get('email').errors.pattern">Formato no válido</div>
                              
                           </div> -->
                           

                        </div>
                      </div>
                          </div>

                          <div class="modal-footer">
                            <a  class="btn btn-primary" data-toggle="modal" [attr.data-target]="'#ConfirmationDay' +(i+1)+''+(j+1)" data-backdrop="static" data-keyboard="false">Cancelar</a>
                            <button type="button" class="btn btn-primary" [disabled]="!activity.valid" data-dismiss="modal">Crear Actividad</button>
                          </div>

                          <!-- Confirmation Activity modal-->
         
                          <div class="modal fade" id="ConfirmationDay{{(i+1)+''+(j+1)}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="exampleModalLongTitle">Confirmación</h5>
                                </div>
                                <div class="modal-body">
                                  ¿Quieres conservar los datos de la actividad?
                                </div>
                                <div class="modal-footer">
                                  <a type="button" class="btn btn-secondary" (click)="resetForm(activity)" data-dismiss="modal">Cancelar</a>
                                  <a type="button" class="btn btn-primary" data-dismiss="modal">Confirmar</a>
                                </div>
                              </div>
                            </div>
                          </div>

                        <!-- End activity confirmation modal -->






















                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
      <br>
    </article>
  </section>
</form>



